<!--
  Frontline LXP Prototype - Content Box Loader

  Copy this entire content into an LXP Content Block to load the prototype.

  INSTRUCTIONS:
  1. Go to Admin > Customisable Dashboard
  2. Add a new Content Block
  3. Switch to "Raw Editor" mode
  4. Paste this entire content
  5. Save and preview

  IMPORTANT: Replace YOUR_GITHUB_USERNAME with your actual GitHub username
  after deploying the repository to GitHub Pages.
-->

<div id="frontline-app">
  <!-- Loading state - styled by our CSS, minimal inline for pre-CSS load -->
  <div id="frontline-loading">
    <div class="spinner"></div>
    <p>Loading Frontline LXP...</p>
  </div>
</div>

<script>
  // Nuke all existing CSS from the LXP to prevent style conflicts
  (function() {
    // Remove all external stylesheets
    var stylesheets = document.querySelectorAll('link[rel="stylesheet"]');
    stylesheets.forEach(function(sheet) {
      sheet.parentNode.removeChild(sheet);
    });

    // Remove all inline style elements (except ours inside #frontline-app)
    var styles = document.querySelectorAll('style');
    styles.forEach(function(style) {
      if (!style.closest('#frontline-app') && !style.parentNode.closest('#frontline-app')) {
        style.parentNode.removeChild(style);
      }
    });

    console.log('[Frontline LXP] Removed ' + stylesheets.length + ' stylesheets and ' + styles.length + ' style elements');
  })();
</script>

<script>
  // Pass LXP context to the prototype
  window.FRONTLINE_CONFIG = {
    userId: window.USER_ID,
    userName: window.USER_NAME || window.USER_FIRST_NAME + ' ' + window.USER_LAST_NAME,
    userEmail: window.USER_EMAIL || window.EMAIL,
    token: window.BEARER_TOKEN,
    orgId: window.ORG_ID,
    orgAlias: window.ORG_ALIAS,
    apiBase: window.location.origin + '/lxp/api/v1'
  };

  console.log('[Frontline LXP] Config loaded:', {
    userId: window.FRONTLINE_CONFIG.userId,
    userName: window.FRONTLINE_CONFIG.userName,
    orgAlias: window.FRONTLINE_CONFIG.orgAlias,
    hasToken: !!window.FRONTLINE_CONFIG.token
  });
</script>

<!-- Load the prototype app from GitHub Pages with cache busting -->
<script>
  (function() {
    var baseUrl = 'https://ee0pdt.github.io/frontline-lxp-prototype';
    var cacheBuster = '?v=' + Date.now();

    // Load CSS
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = baseUrl + '/frontline-app.css' + cacheBuster;
    link.onerror = function() {
      console.error('[Frontline LXP] Failed to load CSS');
    };
    document.head.appendChild(link);

    // Load JS module - crossorigin required for module scripts from different origins
    var script = document.createElement('script');
    script.type = 'module';
    script.crossOrigin = 'anonymous';
    script.src = baseUrl + '/frontline-app.js' + cacheBuster;
    script.onerror = function() {
      console.error('[Frontline LXP] Failed to load JS module');
      var loading = document.getElementById('frontline-loading');
      if (loading) {
        loading.innerHTML = '<p style="color: #FF4B4B; font-weight: 600;">Failed to load app. Please refresh.</p>';
      }
    };
    document.body.appendChild(script);

    console.log('[Frontline LXP] Loading assets with cache buster:', cacheBuster);
  })();
</script>
