<!--
  Frontline LXP Prototype - Content Box Loader

  Copy this entire content into an LXP Content Block to load the prototype.

  INSTRUCTIONS:
  1. Go to Admin > Customisable Dashboard
  2. Add a new Content Block
  3. Switch to "Raw Editor" mode
  4. Paste this entire content
  5. Save and preview

  IMPORTANT: Replace YOUR_GITHUB_USERNAME with your actual GitHub username
  after deploying the repository to GitHub Pages.
-->

<style>
  /* Hide LXP page elements when prototype is loaded */

  /* Hide common header/navigation elements */
  header,
  .header,
  .site-header,
  .main-header,
  nav:not(#frontline-app nav),
  .navbar,
  .nav-bar,
  .navigation,
  .top-bar {
    display: none !important;
  }

  /* Hide sidebar elements */
  aside,
  .sidebar,
  .side-bar,
  .left-sidebar,
  .right-sidebar {
    display: none !important;
  }

  /* Hide footer elements */
  footer,
  .footer,
  .site-footer,
  .main-footer {
    display: none !important;
  }

  /* Hide any siblings of the app container */
  #frontline-app ~ *,
  #frontline-app ~ *::before,
  #frontline-app ~ *::after {
    display: none !important;
  }

  /* Hide previous siblings using :has() - modern browsers */
  *:has(~ #frontline-app):not(script):not(style):not(link):not(#frontline-app) {
    display: none !important;
  }

  /* Hide dashboard-specific content */
  .dashboard,
  .dashboard-content,
  .dashboard-widgets,
  .content-area:not(:has(#frontline-app)),
  .main-content:not(:has(#frontline-app)) {
    display: none !important;
  }

  /* Make app container break out of any parent constraints */
  #frontline-app {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    min-height: 100vh !important;
    z-index: 9999 !important;
    display: flex !important;
    flex-direction: column !important;
    background: #F7F7F7 !important;
    overflow-y: auto !important;
  }

  /* Prevent body scroll when app is loaded */
  body:has(#frontline-app) {
    overflow: hidden !important;
  }
</style>

<div id="frontline-app">
  <!-- Loading state while app loads -->
  <div id="frontline-loading" style="
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    font-family: 'Nunito', system-ui, sans-serif;
    background: #F7F7F7;
  ">
    <div style="
      width: 48px;
      height: 48px;
      border: 4px solid #58CC02;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    "></div>
    <p style="margin-top: 16px; color: #777; font-weight: 600;">Loading Frontline LXP...</p>
  </div>
  <style>
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</div>

<script>
  // Pass LXP context to the prototype
  window.FRONTLINE_CONFIG = {
    userId: window.USER_ID,
    userName: window.USER_NAME || window.USER_FIRST_NAME + ' ' + window.USER_LAST_NAME,
    userEmail: window.USER_EMAIL || window.EMAIL,
    token: window.BEARER_TOKEN,
    orgId: window.ORG_ID,
    orgAlias: window.ORG_ALIAS,
    apiBase: window.location.origin + '/lxp/api/v1'
  };

  console.log('[Frontline LXP] Config loaded:', {
    userId: window.FRONTLINE_CONFIG.userId,
    userName: window.FRONTLINE_CONFIG.userName,
    orgAlias: window.FRONTLINE_CONFIG.orgAlias,
    hasToken: !!window.FRONTLINE_CONFIG.token
  });
</script>

<!-- Load the prototype app from GitHub Pages with cache busting -->
<script>
  (function() {
    var baseUrl = 'https://ee0pdt.github.io/frontline-lxp-prototype';
    var cacheBuster = '?v=' + Date.now();

    // Load CSS
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = baseUrl + '/frontline-app.css' + cacheBuster;
    document.head.appendChild(link);

    // Load JS module
    var script = document.createElement('script');
    script.type = 'module';
    script.src = baseUrl + '/frontline-app.js' + cacheBuster;
    document.body.appendChild(script);

    console.log('[Frontline LXP] Loading assets with cache buster:', cacheBuster);
  })();
</script>
